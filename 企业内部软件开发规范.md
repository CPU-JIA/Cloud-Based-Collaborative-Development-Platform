**文件编号:** DEV-STD-2024-V4.0
**文件标题:** 企业云原生软件开发规范
**版本:** 4.0
**发布日期:** 2024-05-22
**生效日期:** 2024-06-01
**编制部门:** 技术委员会 (Tech Committee)

#### **1. 概述**

本规范旨在统一公司内部所有软件项目的开发流程、技术标准和质量要求，以提升开发效率、保障代码质量、降低维护成本，并促进团队间的协作与知识沉淀。所有新项目必须遵循本规范，现有项目应逐步向本规范对齐。

#### **2. 版本控制规范 (基于Git)**

**2.1 分支模型**
统一采用 **Git Flow** 的简化与改良版：

- 
- **main / master 分支:** 对应生产环境的稳定代码，受保护，只接受来自 release 分支或热修复分支的合并请求（Merge Request）。每次合并必须打上语义化版本号的Tag (vX.Y.Z)。
- **develop 分支:** 集成所有已完成功能的分支，是下一个版本的“准发布”分支。CI/CD流水线会在此分支上运行完整的集成测试和代码质量扫描。
- **feature/ 分支 (如 feature/user-login):** 用于开发新功能。必须从 develop 分支创建，并最终合并回 develop 分支。
- **release/ 分支 (如 release/v1.2.0):** 用于准备发布新版本。从 develop 分支创建。在此分支上只进行BUG修复、文档生成等发布前准备工作。测试通过后，合并到 main 和 develop 分支。
- **hotfix/ 分支 (如 hotfix/v1.1.1):** 用于修复生产环境的紧急BUG。必须从 main 分支的对应Tag创建，修复完成后，必须同时合并回 main 和 develop 分支。

**2.2 提交信息规范 (Commit Message)**
必须遵循 **Conventional Commits** 规范。格式为：<type>(<scope>): <subject>。

- 
- **type**: feat (新功能), fix (BUG修复), docs (文档), style (格式), refactor (重构), test (测试), chore (构建/工具) 等。
- **示例:** feat(auth): add multi-factor authentication support

**2.3 代码仓库结构规范 (Monorepo vs. Multi-repo)**

- 
- **推荐策略:** 对紧密耦合的微服务或共享库，推荐使用 **Monorepo** 模式，以简化依赖管理和原子化提交。对独立性强的服务，可使用Multi-repo。
- **目录结构:** 所有代码仓库根目录必须包含一个README.md文件，清晰说明项目用途、如何构建、如何运行、核心负责人。必须包含一个.gitignore文件，以排除不必要的文件。

#### **3. 编码与架构规范**

**3.1 编码原则**
遵循SOLID原则，保持代码简洁、可读、可维护 (Clean Code)。

**3.2 语言特定规范**

- 
- **Go:** 遵循官方的 Effective Go 指南，使用 gofmt 或 goimports 自动格式化代码。
- **Java:** 遵循 Google Java Style Guide。
- **JavaScript/TypeScript (React):** 遵循 Airbnb JavaScript Style Guide，并使用ESLint和Prettier进行静态检查和自动格式化。

**3.3 错误处理**
不允许吞噬错误。必须显式处理或向上传播错误。禁止使用空的 catch 块。

**3.4 日志记录**
必须使用公司统一的日志库，输出结构化日志(JSON格式)。日志级别分为 DEBUG, INFO, WARN, ERROR, FATAL。禁止在日志中记录任何敏感信息（密码、密钥、个人身份信息等）。

**3.5 API设计规范 (API as a Product)**

- 
- **规范标准:** 所有RESTful API必须遵循 **OpenAPI 3.0+** 规范。API定义文件（openapi.yaml）必须作为代码一并存储在版本库中。
- **版本管理:** API必须支持版本化，推荐在URL中加入版本号（如 /api/v1/...）。
- **向后兼容性:** 任何破坏性API变更，必须提前至少一个季度通知消费者，并提供至少为期半年的旧版本支持。
- **设计原则:** API设计必须符合**幂等性**要求（对GET, PUT, DELETE等）。

**3.6 容器化规范**

- 
- **基础镜像:** 所有应用必须使用公司信息安全部提供并维护的**“黄金基础镜像” (Golden Base Image)**。该镜像已预装必要的安全补丁和监控Agent。禁止使用来源不明的Docker Hub镜像。
- **Dockerfile最佳实践:** 必须遵循多阶段构建（Multi-stage builds）以减小最终镜像体积。禁止在镜像中存储任何密钥或敏感配置。必须使用非root用户运行应用。

#### **4. 代码审查 (Code Review)**

- 
- 所有向 develop 和 main 分支的合并请求都必须经过至少一位非代码作者的资深工程师审查（Approved）。
- 审查重点：功能实现正确性、代码可读性、是否符合设计、是否遵循编码规范、是否存在潜在安全漏洞、测试覆盖率是否达标。
- 鼓励建设性、尊重的审查文化。评论应针对代码，而非作者。
- **审查自动化:**
  - 
  - 所有合并请求必须自动触发代码风格检查(Linter)、安全扫描(SAST)和代码复杂度分析。这些检查不通过，合并请求将被自动阻止。
  - 审查不仅包括应用代码，也必须包括**Dockerfile、CI/CD配置文件(YAML)和基础设施即代码(Terraform/Pulumi)文件**。

#### **5. 测试规范**

- 
- **单元测试:** 核心业务逻辑和关键算法的单元测试覆盖率不得低于 **80%**。强烈推荐引入**变异测试 (Mutation Testing)**来评估测试用例的真实有效性，而不仅仅是代码行覆盖率。
- **集成测试:** 必须覆盖关键的服务间API调用和外部依赖交互。
- **契约测试 (Contract Testing):** 对于微服务间的交互，推荐使用**契约测试**（如Pact）来替代脆弱、缓慢的端到端集成测试，确保服务间的API兼容性。
- **端到端(E2E)测试:** 关键用户旅程（如用户注册、下单支付）必须有自动化E2E测试覆盖。

#### **6. 配置与基础设施管理规范**

- 
- **配置即代码 (Config as Code):** 应用的所有环境配置（开发、测试、生产）必须以代码形式（如YAML, HCL）存储在版本库中。禁止在Web界面上手动修改生产环境配置。
- **基础设施即代码 (Infrastructure as Code):** 所有云资源的创建和管理必须通过**Terraform或Pulumi**等工具实现。所有IaC代码必须经过代码审查和自动化测试。